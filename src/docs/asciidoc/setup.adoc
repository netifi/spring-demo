s= Setup

In our application we have two central components that requires to be setup.


== Setup Postgres

The first component is Postgres. In order to run the demo Postgres database, we are using Docker. The following command creates the initial docker container with Postgres database:

[source,sh]
docker run \
  --name postgres-marvel \
  -p 5432:5432 \
  -e POSTGRES_DB="marvel" \
  -e POSTGRES_USER="captain" \
  -e POSTGRES_PASSWORD="america" \
  postgres

Once the container is created and run we need to execute a list of commands that prepare the required data. Make sure that the commands it executed within the project root folder:

[source,sh]
docker cp ./records.csv postgres-marvel:records.csv

By running the above command we will copy the records with Superhero stats and descriptions of the created container.
Once the data is upload we need to execute a few remote SQL commands that create `records` table and prepare index:

[source,sh]
docker exec -ti postgres-marvel sh -c 'psql --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" -c "CREATE TABLE records (id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY, aliases varchar[], authors varchar[], description varchar, background varchar, thumbnail varchar, name varchar, partners varchar[], powers varchar[], comic_count int, event_count int, pageview_count int, serie_count int, story_count int, secret_identities varchar[], species varchar[], supername varchar, teams varchar[], marvel_url varchar, wikipedia_url varchar);"'

Once the `records` table is created we may upload data from the `records.json` file:

[source, sh]
docker exec -ti postgres-marvel sh -c 'cat records.csv | psql --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" -c "COPY records(aliases,authors,description,background,thumbnail,name,partners,powers,comic_count,event_count,pageview_count,serie_count,story_count,secret_identities,species,supername,teams,marvel_url,wikipedia_url) FROM STDIN CSV;"'

== Setup Proteus Broker

Along with Postgres, we have an additional component required for running Proteus Framework called Proteus Broker. Proteus Broker is a zero-copy data-routing service which is responsible for connecting microservices. In order to run the Proteus Broker
we need to create and run dockerized instance of Proteus Broker using the following command:

[source,sh]
docker run \
  -p 8001:8001 \
  -p 8101:8101 \
  -p 7001:7001 \
  -e BROKER_SERVER_OPTS="'-Dnetifi.authentication.0.accessKey=9007199254740991'  \
  '-Dnetifi.authentication.0.accessToken=kTBDVtfRBO4tHOnZzSyY5ym2kfY=' \
  '-Dnetifi.broker.admin.accessKey=9007199254740991' \
  '-Dnetifi.broker.admin.accessToken=kTBDVtfRBO4tHOnZzSyY5ym2kfY=' \
  '-Dnetifi.broker.ssl.disabled=true'" \
  netifi/proteus


By running the above commands, we make available for the usage the Proteus Borker, which is the last prerequisite for our Reactive System. In the next section, we are going to learn the design of our System and get some understanding of the interaction model between services.
